<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	template="template/template.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="title">
		<h:outputText value="#{staticView.applicationName}" />
	</ui:define>
	<ui:define name="header">
		<ui:include src="template/header.xhtml" />
		<script
			src="https://maps.google.com/maps/api/js?key=AIzaSyCsA6hQ1C8D6IIeB_r2WDEEgPelvpUWIf8&amp;region=MA"
			type="text/javascript" />
	</ui:define>
	<ui:define name="sider">
		<ui:include src="template/sider.xhtml" />
	</ui:define>
	<ui:define name="navigator">
		<ul class="breadcrumb">
			<li><i class="ace-icon fa fa-home" /> <a href="#"> <h:outputText
						value="Main Menu" />
			</a></li>
			<li class="active"><h:outputText
					value="Assign Transportation Job" /></li>
		</ul>
	</ui:define>
	<ui:define name="body">
		<p:importEnum type="ma.azdad.model.TransportationJobAssignmentType"
			var="TransportationJobAssignmentType" allSuffix="ALL_ENUM_VALUES" />
		<h:form id="main_form">
			<div class="page-header hidden-xs">
				<h1>
					<h:outputText value="Assign" />
				</h1>
			</div>
			
			<div class="hr dotted" />
			<div class="row">
				<div class="col-sm-12">
					<div class="tabbable">
						<ul class="nav nav-tabs padding-16">
							<li class="active"><a data-toggle="tab" href="#tab1"> <i
									class="green fa fa-edit bigger-125"></i> <h:outputText
										value="Assign Transportation Job" />
							</a></li>
						</ul>
					</div>

					<div class="tab-content profile-edit-tab-content">
						<div class="tab-pane in active">

							<!-- Step Progress Indicator -->
							<div class="row">
								<div class="col-sm-12">
									<div class="step-progress">
										<div
											class="step #{transportationJobView.currentStep >= 1 ? 'active' : ''} #{transportationJobView.currentStep > 1 ? 'completed' : ''}">
											<span class="step-number">1</span> <span class="step-title">Assignment
												Selection</span>
										</div>
										<div
											class="step #{transportationJobView.currentStep >= 2 ? 'active' : ''} #{transportationJobView.currentStep > 2 ? 'completed' : ''}">
											<span class="step-number">2</span> <span class="step-title">Schedule
												And Location</span>
										</div>
										<div
											class="step #{transportationJobView.currentStep >= 3 ? 'active' : ''}">
											<span class="step-number">3</span> <span class="step-title">Summary</span>
										</div>
									</div>
								</div>
							</div>
							<div class="space-16"></div>
							<p:messages id="messages" closable="true" />

							<!-- STEP 1: Assignment Selection (Assignment Type, Drivers/Transporters, Vehicle, Map) -->
							<h:panelGroup id="main_pan"
								rendered="#{transportationJobView.currentStep == 1}">
								<h4 class="header blue bolder smaller">
									<i class="fa fa-user"></i>
									<h:outputText value="Step 1: Assignment Selection" />
								</h4>

								<!-- Assignment Type Selection -->
								<div class="row">
									<div class="col-xs-12 col-sm-6">
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 control-label no-padding-right">
												<h:outputText value="Assignment Type" />
											</label>
											<div class="col-xs-9 col-sm-9">
												<h:selectOneMenu
													value="#{transportationJobView.transportationJob.assignmentType}"
													required="true" requiredMessage="Type should not be null">
													<f:selectItem itemLabel="---" noSelectionOption="true" />
													<f:selectItem
														itemLabel="#{TransportationJobAssignmentType.TRANSPORTER.value}"
														itemValue="#{TransportationJobAssignmentType.TRANSPORTER}" />
													<f:selectItem
														itemLabel="#{TransportationJobAssignmentType.INTERNAL_DRIVER.value}"
														itemValue="#{TransportationJobAssignmentType.INTERNAL_DRIVER}" />
													<f:selectItem
														itemLabel="#{TransportationJobAssignmentType.EXTERNAL_DRIVER.value}"
														itemValue="#{TransportationJobAssignmentType.EXTERNAL_DRIVER}" />
													<p:ajax
														listener="#{transportationJobView.changeTransportationJobAssignmentTypeListener()}"
														update="assignmentSelectionPanel,mapPanel,main_pan" />
												</h:selectOneMenu>
											</div>
										</div>
									</div>
								</div>
								<div class="space-16"></div>

								<!-- Assignment Selection Panel -->
								<h:panelGroup id="assignmentSelectionPanel">
									<!-- Transporter Selection -->
									<f:subview
										rendered="#{TransportationJobAssignmentType.TRANSPORTER==transportationJobView.transportationJob.assignmentType}">
										<div class="row">
											<div class="col-sm-12">
												<div class="table-header col-sm-12 col-xs-12">
													<div class="col-sm-10 hidden-xs">
														<i class="fa fa-list" />
														<h:outputText value=" Select Transporter" />
													</div>
													<div class="col-sm-2 col-xs-4">
														<div class="nav-search minimized">
															<span class="input-icon"> <p:inputText
																	value="#{transporterView.searchBean}"
																	placeholder="Search..."
																	styleClass="input-small nav-search-input"
																	autocomplete="off">
																	<p:ajax event="keyup" update="transporterList" />
																</p:inputText> <i class="ace-icon fa fa-search nav-search-icon" />
															</span>
														</div>
													</div>
												</div>
												<div class="col-sm-12 col-xs-12 aa-datatable-container">
													<p:dataTable id="transporterList"
														widgetVar="transporterList"
														value="#{transporterView.list2}"
														filteredValue="#{transporterView.list3}"
														rowKey="#{item.id}"
														selection="#{transportationJobView.transportationJob.transporter}"
														var="item" rows="5"
														styleClass="table table-striped table-hover center"
														paginatorAlwaysVisible="false" paginator="true"
														paginatorPosition="bottom" rowSelectMode="checkbox">
														<p:ajax event="rowSelectRadio" update="@(.map-container)" />
														<p:column selectionMode="single"
															styleClass="ace aa-checkbox-column" />
														<p:column headerText="Name">
															<h:outputText value="#{item.name}"
																styleClass="bolder orange" />
														</p:column>
														<p:column headerText="Type">
															<h:outputText value="#{item.type.value}"
																styleClass="#{item.type.color}" />
														</p:column>
														<p:column headerText="Email">
															<h:outputText value="#{item.email}"
																styleClass="bolder light-blue" />
														</p:column>
														<p:column headerText="Phone">
															<h:outputText value="#{item.phone}"
																styleClass="bolder light-green" />
														</p:column>
													</p:dataTable>
												</div>
											</div>
										</div>
									</f:subview>

									<!-- Driver Selection -->
									<f:subview
										rendered="#{TransportationJobAssignmentType.INTERNAL_DRIVER==transportationJobView.transportationJob.assignmentType or TransportationJobAssignmentType.EXTERNAL_DRIVER==transportationJobView.transportationJob.assignmentType}">
										<div class="row">
											<div class="col-sm-12">
												<div class="table-header col-sm-12 col-xs-12">
													<div class="col-sm-6 hidden-xs">
														<i class="fa fa-truck" />
														<h:outputText value=" Select Driver" />
													</div>
													<div class="col-sm-4 hidden-xs">
														<i class="fa fa-list" />
														<h:outputText value=" Sort By " style="margin-right:20px" />
														<h:selectOneMenu value="#{userView.sortBy}">
															<f:selectItem itemLabel="Pending TR"
																itemValue="Pending TR" />
															<f:selectItem itemLabel="Reactivity"
																itemValue="Reactivity" />
															<f:selectItem itemLabel="Distance to site"
																itemValue="Distance to site" />
															<p:ajax listener="#{userView.sort()}" update="driverList" />
														</h:selectOneMenu>
													</div>
													<div class="col-sm-2 col-xs-4">
														<div class="nav-search minimized">
															<span class="input-icon"> <p:inputText
																	value="#{userView.searchBean}" placeholder="Search..."
																	styleClass="input-small nav-search-input"
																	autocomplete="off">
																	<p:ajax event="keyup" update="driverList" />
																</p:inputText> <i class="ace-icon fa fa-search nav-search-icon" />
															</span>
														</div>
													</div>
												</div>
												<div class="col-sm-12 col-xs-12 aa-datatable-container">
													<p:dataTable id="driverList" widgetVar="driverList"
														value="#{userView.list2}"
														filteredValue="#{userView.list3}"
														rowKey="#{item.username}"
														selection="#{transportationJobView.transportationJob.driver}"
														var="item" rows="5"
														styleClass="table table-striped table-hover center"
														paginatorAlwaysVisible="false" paginator="true"
														paginatorPosition="bottom" rowSelectMode="checkbox">
														<p:ajax event="rowSelectRadio"
															update=":main_form:main_pan" />
														<p:column selectionMode="single"
															styleClass="ace aa-checkbox-column" />
														<p:column headerText="Photo" width="80" exportable="false"
															styleClass="hidden-xs">
															<p:graphicImage value="#{fileUploadView.stream}"
																styleClass="img-circle aa-datatable-photo">
																<f:param name="fileName" value="#{item.photo}" />
															</p:graphicImage>
														</p:column>
														<p:column headerText="Full Name">
															<h:outputText value="#{item.fullName}"
																styleClass="bolder green" />
														</p:column>
														<p:column headerText="Transporter">
															<h:outputText value="#{item.transporterName}"
																styleClass="bolder pink" />
														</p:column>
														<p:column headerText="Email">
															<h:outputText value="#{item.email}" styleClass="blue" />
														</p:column>
														<p:column headerText="Phone">
															<h:outputText value="#{item.phone}" styleClass="orange" />
														</p:column>
														<p:column headerText="CIN">
															<h:outputText value="#{item.cin}"
																styleClass="bolder purple" />
														</p:column>
														<p:column headerText="Pending TR"
															styleClass="#{userView.sortBy=='Pending TR'?'aa-background-blue':''}">
															<h:outputText value="#{item.countPendingTr}"
																styleClass="bolder" />
														</p:column>
														<p:column headerText="Reactivity"
															styleClass="#{userView.sortBy=='Reactivity'?'aa-background-blue':''}">
															<h:outputText value="#{item.reactivity}">
																<f:convertNumber type="number" maxFractionDigits="0" />
															</h:outputText>
															<h:outputText value=" %" />
														</p:column>
														<p:column headerText="Distance To Site"
															styleClass="#{userView.sortBy=='Distance to site'?'aa-background-blue':''}">
															<h:outputText value="#{item.distance}">
																<f:convertNumber type="number" maxFractionDigits="0" />
															</h:outputText>
															<h:outputText value=" Km"
																rendered="#{item.distance!=null}" />
														</p:column>
													</p:dataTable>
												</div>
											</div>
										</div>
									</f:subview>

									<!-- Vehicle Selection Panel -->
									<h:panelGroup id="vehicleListPanel">
										<f:subview
											rendered="#{transportationJobView.transportationJob.driver!=null}">
											<div class="space-8" />
											<div class="row">
												<div class="col-sm-offset-1 col-sm-10">
													<div class="table-header col-sm-12 col-xs-12">
														<i class="fa fa-list" />
														<h:outputText value=" Vehicle List" />
													</div>
													<div class="col-sm-12 col-xs-12 aa-datatable-container">
														<p:dataTable id="vehicleList" widgetVar="vehicleList"
															value="#{transportationJobView.vehicleSelectionList}"
															rowKey="#{item.id}"
															selection="#{transportationJobView.transportationJob.vehicle}"
															var="item" rows="5"
															styleClass="table table-striped table-hover center"
															paginatorAlwaysVisible="false" paginator="true"
															paginatorPosition="bottom"
															paginatorTemplate="{JumpToPageDropdown} {LastPageLink} {FirstPageLink}  {PageLinks}"
															rowSelectMode="checkbox">
															<p:ajax event="rowSelectRadio"
																update=":main_form:main_pan" />
															<p:column selectionMode="single"
																styleClass="ace aa-checkbox-column" />
															<p:column headerText="Matricule">
																<h:outputText value="#{item.correctMatricule}"
																	styleClass="purple bolder" />
															</p:column>
															<p:column headerText="Vehicle Type">
																<h:outputText value="#{item.vehicleType.name}"
																	styleClass="bolder green" />
															</p:column>
															<p:column headerText="Max Weight">
																<h:outputText value="#{item.maxWeight}">
																	<f:convertNumber type="number" maxFractionDigits="2" />
																</h:outputText>
																<h:outputText value=" Kg" />
															</p:column>
															<p:column headerText="Max Volume">
																<h:outputText value="#{item.maxVolume}">
																	<f:convertNumber type="number" maxFractionDigits="2" />
																</h:outputText>
																<h:outputText value=" m3" />
															</p:column>
														</p:dataTable>
													</div>
												</div>
											</div>
										</f:subview>
									</h:panelGroup>
								</h:panelGroup>

								<!-- Map for Step 1 -->
								<div class="space-16"></div>
								<div class="map-container">
									<h:panelGroup id="mapPanel">
										<h5 class="header smaller blue">
											<i class="fa fa-map-marker"></i>
											<h:outputText value=" Current Selection Overview" />
										</h5>
										<iframe
											src="#{request.contextPath}/transportationJobAssignMap.html?jobId=#{transportationJobView.transportationJob.id}&amp;type=#{transportationJobView.transportationJob.assignmentType.value}&amp;step=1"
											style="width: 100%; height: 400px; border: none;"> </iframe>
									</h:panelGroup>
								</div>

								<!-- Step 1 Navigation -->
								<div class="space-16"></div>
								<div class="row">
									<div class="col-sm-12 text-right">
										<p:commandButton value="Next: Schedule And Location"
											action="#{transportationJobView.goToStep2()}"
											update=":main_form" styleClass="btn btn-primary"
											disabled="#{transportationJobView.isStep1Incomplete()}" />
									</div>
								</div>
							</h:panelGroup>

							<!-- STEP 2: Schedule & Location (Lead Times, Position, Map) -->
							<h:panelGroup
								rendered="#{transportationJobView.currentStep == 2}">
								<h4 class="header blue bolder smaller">
									<i class="fa fa-clock-o"></i>
									<h:outputText value="Step 2: Schedule And Location Details" />
								</h4>

								<!-- Lead Times -->
								<div class="row">
									<div class="col-xs-12 col-sm-6">
										<div class="form-group">
											<label
												class="col-xs-4 col-sm-4 control-label no-padding-right">
												<h:outputText value="Accept Lead Time" />
											</label>
											<div class="col-xs-8 col-sm-8">
												<p:inputNumber
													value="#{transportationJobView.transportationJob.acceptLeadTime}"
													thousandSeparator="" decimalSeparator="." minValue="0"
													required="true"
													requiredMessage="Accept Lead Time should not be null"
													placeholder="(in hours)" />
											</div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-6">
										<div class="form-group">
											<label
												class="col-xs-4 col-sm-4 control-label no-padding-right">
												<h:outputText value="Start Lead Time" />
											</label>
											<div class="col-xs-8 col-sm-8">
												<p:inputNumber
													value="#{transportationJobView.transportationJob.startLeadTime}"
													thousandSeparator="" decimalSeparator="." minValue="0"
													required="true"
													requiredMessage="Start Lead Time should not be null"
													placeholder="(in hours)" />
											</div>
										</div>
									</div>
								</div>

								<div class="space-16"></div>

								<!-- Position Selection -->
								<h5 class="header smaller blue">
									<i class="fa fa-map-marker"></i>
									<h:outputText value=" Planned Start Location" />
								</h5>
								<div class="row">
									<div class="col-xs-12 col-sm-6">
										<div class="form-group">
											<label
												class="col-xs-4 col-sm-4 control-label no-padding-right">
												<h:outputText value="Latitude" />
											</label>
											<div class="col-xs-8 col-sm-8">
												<p:inputText id="lat"
													value="#{transportationJobView.transportationJob.plannedStartLatitude}"
													required="true" readonly="true"
													requiredMessage="Latitude should not be null. Please select by clicking on the map!"
													placeholder="Click on map to set latitude" />
											</div>
										</div>
									</div>
									<div class="col-xs-12 col-sm-6">
										<div class="form-group">
											<label
												class="col-xs-4 col-sm-4 control-label no-padding-right">
												<h:outputText value="Longitude" />
											</label>
											<div class="col-xs-8 col-sm-8">
												<p:inputText id="lng"
													value="#{transportationJobView.transportationJob.plannedStartLongitude}"
													required="true" readonly="true"
													requiredMessage="Longitude should not be null. Please select by clicking on the map!"
													placeholder="Click on map to set longitude" />
											</div>
										</div>
									</div>
								</div>
								<p:commandButton id="updateCoordsBtn"
									action="#{transportationJobView.updateCoordinates()}"
									style="display:none;" />

								<!-- Hidden inputs to capture map coordinates -->
								<p:inputText id="hiddenLat"
									value="#{transportationJobView.mapLatitude}"
									style="display:none;" />
								<p:inputText id="hiddenLng"
									value="#{transportationJobView.mapLongitude}"
									style="display:none;" />

								<!-- Interactive Map for Step 2 -->
								<div class="space-16"></div>
								<div class="alert alert-info">
									<i class="fa fa-info-circle"></i> <strong>Instructions:</strong>
									Click on the map below to set the planned start location for
									this transportation job.
								</div>
								<iframe
									src="#{request.contextPath}/transportationJobAssignMap.html?jobId=#{transportationJobView.transportationJob.id}&amp;type=#{transportationJobView.transportationJob.assignmentType.value}&amp;step=2"
									style="width: 100%; height: 500px; border: none;"> </iframe>

								<!-- Step 2 Navigation -->
								<div class="space-16"></div>
								<div class="row">
									<div class="col-sm-6">
										<p:commandButton value="← Back to Selection"
											action="#{transportationJobView.goToStep1()}"
											update=":main_form" styleClass="btn btn-default" />
									</div>
									<div class="col-sm-6 text-right">
										<p:commandButton value="Next: Summary"
											action="#{transportationJobView.goToStep3()}"
											update=":main_form" styleClass="btn btn-primary"
											disabled="false" />
									</div>
								</div>
							</h:panelGroup>

							<!-- STEP 3: Summary -->
							<h:panelGroup
								rendered="#{transportationJobView.currentStep == 3}">
								<h4 class="header blue bolder smaller">
									<i class="fa fa-check-circle"></i>
									<h:outputText value="Step 3: Assignment Summary" />
								</h4>

								<div class="alert alert-info">
									<i class="fa fa-info-circle"></i> <strong>Review your
										assignment details before finalizing.</strong>
								</div>

								<div class="row">
									<div class="col-sm-12">
										<div class="widget-box widget-color-blue">
											<div class="widget-header">
												<h4 class="widget-title">
													<i class="fa fa-list"></i> Assignment Summary
												</h4>
											</div>
											<div class="widget-body">
												<div class="widget-main">

													<!-- Assignment Type Summary -->
													<div class="summary-section">
														<h5 class="summary-title">
															<i class="fa fa-tag blue"></i> Assignment Type
														</h5>
														<div class="summary-content">
															<span class="label label-primary"> <h:outputText
																	value="#{transportationJobView.transportationJob.assignmentType.value}" />
															</span>
														</div>
													</div>

													<!-- Transporter/Driver Summary -->
													<div class="summary-section">
														<h5 class="summary-title">
															<i class="fa fa-user blue"></i>
															<h:outputText
																value="#{transportationJobView.transportationJob.assignmentType eq 'TRANSPORTER' 
                     ? 'Assigned Transporter' 
                     : 'Assigned Driver'}" />
														</h5>

														<div class="summary-content">
															<!-- Transporter Info (only if assignmentType = TRANSPORTER) -->
															<h:panelGroup
																rendered="#{transportationJobView.transportationJob.assignmentType eq 'TRANSPORTER'}">
																<div class="info-item">
																	<strong>Name:</strong> <span class="bolder orange">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.transporter.name}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Type:</strong> <span
																		class="#{transportationJobView.transportationJob.transporter.type.color}">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.transporter.type.value}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Email:</strong> <span class="bolder light-blue">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.transporter.email}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Phone:</strong> <span
																		class="bolder light-green"> <h:outputText
																			value="#{transportationJobView.transportationJob.transporter.phone}" />
																	</span>
																</div>
															</h:panelGroup>

															<!-- Driver Info (only if assignmentType ≠ TRANSPORTER) -->
															<h:panelGroup
																rendered="#{transportationJobView.transportationJob.assignmentType ne 'TRANSPORTER'}">
																<div class="info-item">
																	<strong>Full Name:</strong> <span class="bolder green">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.driver.fullName}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Email:</strong> <span class="blue"> <h:outputText
																			value="#{transportationJobView.transportationJob.driver.email}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Phone:</strong> <span class="orange"> <h:outputText
																			value="#{transportationJobView.transportationJob.driver.phone}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>CIN:</strong> <span class="bolder purple">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.driver.cin}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Transporter:</strong> <span class="bolder pink">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.driver.transporterName}" />
																	</span>
																</div>
															</h:panelGroup>
														</div>
													</div>


													<!-- Vehicle Summary -->
													<h:panelGroup
														rendered="#{transportationJobView.transportationJob.vehicle != null}">
														<div class="summary-section">
															<h5 class="summary-title">
																<i class="fa fa-truck blue"></i> Assigned Vehicle
															</h5>
															<div class="summary-content">
																<div class="info-item">
																	<strong>Matricule:</strong> <span class="purple bolder">
																		<h:outputText
																			value="#{transportationJobView.transportationJob.vehicle.correctMatricule}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Vehicle Type:</strong> <span
																		class="bolder green"> <h:outputText
																			value="#{transportationJobView.transportationJob.vehicle.vehicleType.name}" />
																	</span>
																</div>
																<div class="info-item">
																	<strong>Max Weight:</strong>
																	<h:outputText
																		value="#{transportationJobView.transportationJob.vehicle.maxWeight}">
																		<f:convertNumber type="number" maxFractionDigits="2" />
																	</h:outputText>
																	<span> Kg</span>
																</div>
																<div class="info-item">
																	<strong>Max Volume:</strong>
																	<h:outputText
																		value="#{transportationJobView.transportationJob.vehicle.maxVolume}">
																		<f:convertNumber type="number" maxFractionDigits="2" />
																	</h:outputText>
																	<span> m³</span>
																</div>
															</div>
														</div>
													</h:panelGroup>

													<!-- Lead Times Summary -->
													<div class="summary-section">
														<h5 class="summary-title">
															<i class="fa fa-clock-o blue"></i> Lead Times
														</h5>
														<div class="summary-content">
															<div class="info-item">
																<strong>Accept Lead Time:</strong> <span class="bolder">
																	<h:outputText
																		value="#{transportationJobView.transportationJob.acceptLeadTime}" />
																	<span> hours</span>
																</span>
															</div>
															<div class="info-item">
																<strong>Start Lead Time:</strong> <span class="bolder">
																	<h:outputText
																		value="#{transportationJobView.transportationJob.startLeadTime}" />
																	<span> hours</span>
																</span>
															</div>
														</div>
													</div>

													<!-- Location Summary -->
													<div class="summary-section">
														<h5 class="summary-title">
															<i class="fa fa-map-marker blue"></i> Planned Start
															Location
														</h5>
														<div class="summary-content">
															<div class="info-item">
																<strong>Latitude:</strong> <span class="bolder">
																	<h:outputText
																		value="#{transportationJobView.transportationJob.plannedStartLatitude}">
																		<f:convertNumber type="number" maxFractionDigits="6" />
																	</h:outputText>
																</span>
															</div>
															<div class="info-item">
																<strong>Longitude:</strong> <span class="bolder">
																	<h:outputText
																		value="#{transportationJobView.transportationJob.plannedStartLongitude}">
																		<f:convertNumber type="number" maxFractionDigits="6" />
																	</h:outputText>
																</span>
															</div>
														</div>
													</div>

												</div>
											</div>
										</div>
									</div>
								</div>

								<!-- Final Map Overview -->


								<!-- Step 3 Navigation -->
								<div class="space-16"></div>
								<div class="row">
									<div class="col-sm-6">
										<p:commandButton value="← Back to Location"
											action="#{transportationJobView.goToStep2()}"
											update=":main_form" styleClass="btn btn-default" />
									</div>
									<div class="col-sm-6 text-right">
										<p:commandButton value="✓ Finish"
											action="#{transportationJobView.assign()}" update="messages"
											styleClass="btn btn-success btn-lg"
											 />
									</div>
								</div>
							</h:panelGroup>

						</div>
					</div>
				</div>
			</div>

			<style>
/* Summary Step Styles */
.summary-section {
	margin-bottom: 25px;
	padding: 15px;
	background-color: #f9f9f9;
	border-radius: 5px;
	border-left: 4px solid #337ab7;
}

.summary-title {
	margin-bottom: 15px;
	margin-top: 0;
	color: #337ab7;
	font-weight: bold;
	border-bottom: 1px solid #e0e0e0;
	padding-bottom: 8px;
}

.summary-title i {
	margin-right: 8px;
}

.summary-content {
	padding-left: 10px;
}

.info-item {
	margin-bottom: 8px;
	padding: 5px 0;
	display: flex;
	align-items: center;
}

.info-item strong {
	min-width: 140px;
	display: inline-block;
	color: #555;
	margin-right: 10px;
}

.info-item span {
	flex: 1;
}

/* Enhanced Widget Box for Summary */
.widget-box.widget-color-blue {
	border: 1px solid #d3d3d3;
	border-radius: 5px;
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.widget-box.widget-color-blue .widget-header {
	background-color: #337ab7;
	color: white;
	padding: 12px 15px;
	border-radius: 5px 5px 0 0;
}

.widget-box.widget-color-blue .widget-header .widget-title {
	margin: 0;
	font-size: 16px;
	font-weight: bold;
}

.widget-box.widget-color-blue .widget-body {
	padding: 0;
}

.widget-box.widget-color-blue .widget-main {
	padding: 20px;
}

/* Step Progress Enhanced Styles */
.step-progress {
	display: flex;
	justify-content: center;
	align-items: center;
	margin: 20px 0;
}

.step {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin: 0 20px;
	position: relative;
}

.step:not(:last-child)::after {
	content: '';
	position: absolute;
	top: 20px;
	right: -20px;
	width: 40px;
	height: 2px;
	background-color: #ddd;
	z-index: -1;
}

.step.completed:not(:last-child)::after {
	background-color: #5cb85c;
}

.step.active:not(:last-child)::after {
	background-color: #337ab7;
}

.step-number {
	width: 40px;
	height: 40px;
	border-radius: 50%;
	background-color: #ddd;
	color: #666;
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: bold;
	margin-bottom: 8px;
	transition: all 0.3s ease;
}

.step.active .step-number {
	background-color: #337ab7;
	color: white;
	transform: scale(1.1);
}

.step.completed .step-number {
	background-color: #5cb85c;
	color: white;
}

.step-title {
	font-size: 12px;
	color: #666;
	text-align: center;
	max-width: 80px;
	line-height: 1.2;
}

.step.active .step-title {
	color: #337ab7;
	font-weight: bold;
}

.step.completed .step-title {
	color: #5cb85c;
	font-weight: bold;
}

/* Responsive adjustments */
@media ( max-width : 768px) {
	.step {
		margin: 0 10px;
	}
	.step:not(:last-child)::after {
		right: -10px;
		width: 20px;
	}
	.step-title {
		font-size: 10px;
		max-width: 60px;
	}
	.info-item {
		flex-direction: column;
		align-items: flex-start;
	}
	.info-item strong {
		min-width: auto;
		margin-bottom: 3px;
		margin-right: 0;
	}
}

/* Color classes for consistency */
.bolder {
	font-weight: bold !important;
}

.orange {
	color: #ff8c00 !important;
}

.light-blue {
	color: #5bc0de !important;
}

.light-green {
	color: #5cb85c !important;
}

.green {
	color: #2e8b57 !important;
}

.pink {
	color: #e91e63 !important;
}

.blue {
	color: #337ab7 !important;
}

.purple {
	color: #9c27b0 !important;
}
</style>
		</h:form>
		<script>
  window.addEventListener("message", function (event) {
	  if (event.data &amp;&amp; event.data.lat &amp;&amp; event.data.lng) {
      // Update the inputs inside main_form
      document.getElementById("main_form:lat").value = event.data.lat;
      document.getElementById("main_form:lng").value = event.data.lng;

   // Update the hidden inputs that will be submitted to the server
		document.getElementById("main_form:hiddenLat").value = event.data.lat;
		document.getElementById("main_form:hiddenLng").value = event.data.lng;

		// Trigger the hidden button to update coordinates in the bean
		document.getElementById("main_form:updateCoordsBtn").click();
    }
  });
</script>

	</ui:define>
</ui:composition>
