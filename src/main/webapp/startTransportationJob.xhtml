<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	template="template/template.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="title">
		<h:outputText value="#{staticView.applicationName}" />
	</ui:define>
	<ui:define name="header">
		<ui:include src="template/header.xhtml" />
		<script
			src="https://maps.google.com/maps/api/js?key=AIzaSyCsA6hQ1C8D6IIeB_r2WDEEgPelvpUWIf8&amp;region=MA"
			type="text/javascript" />
	</ui:define>
	<ui:define name="sider">
		<ui:include src="template/sider.xhtml" />
	</ui:define>
	<ui:define name="navigator">
		<ul class="breadcrumb">
			<li><i class="ace-icon fa fa-home" /> <a href="#"> <h:outputText
						value="Main Menu" />
			</a></li>
			<li class="active"><h:outputText
					value=" Start Transportation Job" /></li>
		</ul>
	</ui:define>
	<ui:define name="body">
		<h:form id="main_form">
			<div class="page-header hidden-xs">
				<h1>
					<i class="ace-icon fa fa-plus green bigger-110"></i>
					<h:outputText value=" Transportation Request List" />
				</h1>
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class=" col-sm-offset-1 col-sm-6">
						<h:outputLink
							styleClass="btn btn-app btn-sm btn-inverse hover aa-tooltip"
							title="Return to Home " value="index.xhtml">
							<i class="ace-icon fa fa-home bigger-230"></i>
							<h:outputText value="Home" />
						</h:outputLink>
						<h:outputLink
							styleClass="btn btn-app btn-sm btn-primary hover aa-tooltip tooltip-info"
							title="Reload page">
							<i class="ace-icon fa fa-refresh bigger-230"></i>
							<h:outputText value="Reload" />
						</h:outputLink>
						<h:outputLink
							styleClass="btn btn-app btn-sm hover aa-tooltip tooltip-grey"
							title="Previous Page" value="javascript: window.history.go(-1)">
							<i class="ace-icon fa fa-undo bigger-230"></i>
							<h:outputText value="Back" />
						</h:outputLink>
						<p:commandLink
							styleClass="btn btn-app btn-sm btn-info hover aa-tooltip"
							action="#{transportationJobView.startTransportationJob()}"
							update=":main_form" title="Start"
							rendered="#{transportationJobView.canStart()}">
							<i class="ace-icon fa fa-check bigger-230"></i>
							<h:outputText value="Start" />
						</p:commandLink>
					</div>
				</div>
			</div>
			<div class="hr dotted" />
			<div class="space-16" />
			<div class="row">
				<div class="col-sm-offset-1 col-sm-10">
					<div class="tab-content profile-edit-tab-content">
						<div class="tab-pane in active">
							<p:messages id="messages" closable="true" />

							<h4 class="header blue bolder smaller">
								<h:outputText value="Select Start Position" />
							</h4>

							<p:inputText id="lat"
								value="#{transportationJobView.transportationJob.startLatitude}"
								type="hidden" />

							<p:inputText id="lng"
								value="#{transportationJobView.transportationJob.startLongitude}"
								type="hidden" />


							<h:panelGroup id="gmap">
								<iframe
									src="#{request.contextPath}/transportationJobStartMap.html?jobId=#{transportationJobView.transportationJob.id}&amp;username=#{transportationJobView.transportationJob.driverUsername}"
									style="width: 100%; height: 500px; border: none;"> </iframe>
							</h:panelGroup>
							<!--<p:gmap id="gmap" widgetVar="gmap" model="#{transportationJobView.mapModel}" center="#{transportationJobView.transportationJob.firstStopValue}" zoom="10" type="TERRAIN"
								style="width:80%;height:400px;margin:auto" >
								
								<p:ajax event="pointSelect" listener="#{transportationJobView.onPointSelect}" update="messages"/>
								
								</p:gmap>-->

							<h4 class="header blue bolder smaller">
								<h:outputText value="Assign Transportation Request List" />
							</h4>
							<div class="row">
								<div class="col-sm-12">
									<div class="table-header col-sm-12 col-xs-12">
										<i class="fa fa-list" />
										<h:outputText value=" TR List" />
									</div>
									<div class="col-sm-12 col-xs-12 aa-datatable-container">
										<p:dataTable id="main_tab"
											value="#{transportationJobView.transportationJob.transportationRequestList}"
											var="item"
											styleClass="table table-striped table-hover center"
											paginatorAlwaysVisible="false" paginator="true"
											paginatorPosition="bottom"
											paginatorTemplate="{JumpToPageDropdown} {LastPageLink} {FirstPageLink}  {PageLinks}">
											<p:column headerText="Reference" width="80">
												<h:outputText value="#{item.reference}"
													styleClass="#{item.deliveryRequest.type.color} bolder" />
											</p:column>
											<p:column headerText="Origin">
												<h:outputText value="#{item.originName}" styleClass="purple" />
												<h:outputText value="#{item.warehouseName}"
													styleClass="purple" rendered="#{item.isOutbound}" />
											</p:column>
											<p:column headerText="Destination">
												<h:outputText value="#{item.destinationName}"
													styleClass="pink" />
												<h:outputText value="#{item.warehouseName}"
													styleClass="pink" rendered="#{item.isInbound}" />
											</p:column>
											<p:column headerText="Planned Pickup Time">
												<h:outputText value="#{item.plannedPickupDate}"
													styleClass="purple">
													<f:convertDateTime pattern="yyyy-MM-dd HH:mm" />
												</h:outputText>
											</p:column>
											<p:column headerText="Expected Pickup Time">
												<p:calendar value="#{item.expectedPickupDate}"
													navigator="true" pattern="yyyy-MM-dd HH:mm" />
											</p:column>
											<p:column headerText="Needed Delivery Time">
												<h:outputText value="#{item.neededDeliveryDate}"
													styleClass="pink">
													<f:convertDateTime pattern="yyyy-MM-dd HH:mm" />
												</h:outputText>
											</p:column>
											<p:column headerText="Status" width="70">
												<h:outputText value="#{item.status.value}"
													styleClass="#{item.status.color}" />
											</p:column>
										</p:dataTable>
									</div>
								</div>
							</div>
							<div class="space-16" />
						</div>
						<div class="row"></div>
					</div>
				</div>
			</div>
		</h:form>
		<script>
  window.addEventListener("message", function (event) {
	  if (event.data &amp;&amp; event.data.lat &amp;&amp; event.data.lng) {
      // Update the inputs inside main_form
      document.getElementById("main_form:lat").value = event.data.lat;
      document.getElementById("main_form:lng").value = event.data.lng;

      // ðŸ”¹ Trigger JSF AJAX update so bean updates immediately
      jsf.ajax.request(
        document.getElementById("main_form:lat"),
        null,
        { execute: "main_form:lat main_form:lng", render: "main_form",
	     params: { "javax.faces.behavior.event": "pointSelect" } }
      );
    }
  });
  </script>
	</ui:define>
</ui:composition>
